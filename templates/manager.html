{% extends "base.html" %} {% block title %}Панель менеджера{% endblock %} {%
block content %}
<div class="container">
  <h2 class="mb-4">Управление клиентами и сотрудниками</h2>

  <ul class="nav nav-tabs" id="managerTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="clients-tab"
        data-bs-toggle="tab"
        data-bs-target="#clients-panel"
        type="button"
      >
        Клиенты ({{ clients|length }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="staff-tab"
        data-bs-toggle="tab"
        data-bs-target="#staff-panel"
        type="button"
      >
        Сотрудники ({{ staff|length }})
      </button>
    </li>
  </ul>

  <div class="tab-content pt-3" id="managerTabsContent">
    <!-- ВКЛАДКА КЛИЕНТЫ -->
    <div class="tab-pane fade show active" id="clients-panel" role="tabpanel">
      <div class="card">
        <div class="card-header"><h5 class="mb-0">Список клиентов</h5></div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ФИО</th>
                  <th>Телефон</th>
                  <th>Дата регистрации</th>
                  <th>Скидка</th>
                  <th>Действия</th>
                </tr>
              </thead>
              <tbody>
                {% for client in clients %}
                <tr>
                  <td>
                    {{ client.last_name }} {{ client.first_name }} {{
                    client.middle_name or '' }}
                  </td>
                  <td>
                    {% set phone = client.contacts|selectattr('contact_type',
                    'equalto', 'phone')|first %}{{ phone.contact_value if phone
                    else '–' }}
                  </td>
                  <td>{{ client.reg_date }}</td>
                  <td>{{ "%.2f"|format(client.discount) }}%</td>
                  <td>
                    <a
                      href="/manager/client/{{ client.id }}/edit"
                      class="btn btn-sm btn-info"
                      >Редактировать</a
                    >
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ВКЛАДКА СОТРУДНИКИ -->
    <div class="tab-pane fade" id="staff-panel" role="tabpanel">
      <div class="card">
        <div class="card-header"><h5 class="mb-0">Список сотрудников</h5></div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ФИО</th>
                  <th>Должность</th>
                  <th>Оклад</th>
                  <th>Пол</th>
                  <th>Телефон</th>
                  <th>ИНН</th>
                  <th>СНИЛС</th>
                  <th>Действия</th>
                </tr>
              </thead>
              <tbody>
                {% for s in staff %}
                <tr>
                  <td>{{ s.last_name }} {{ s.first_name }}</td>
                  <td>{{ s.position.name if s.position else '–' }}</td>
                  <td>{{ "%.2f"|format(s.salary) if s.salary else '–' }}</td>
                  <td>{{ s.gender or '–' }}</td>
                  <td>{{ s.phone or '–' }}</td>
                  <td>{{ s.inn or '–' }}</td>
                  <td>{{ s.snils or '–' }}</td>
                  <td>
                    <a
                      href="/manager/staff/{{ s.id }}/edit"
                      class="btn btn-sm btn-info"
                      >Редактировать</a
                    >
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
